-- ========================================
-- ü©∏ CATHUD MOBILE EDITION (OTIMIZADO)
-- ========================================

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer

-- ================= VARI√ÅVEIS =================
local flying = false
local noclip = false
local speed, minSpeed, maxSpeed = 70, 10, 200
local walkSpeed, minWalkSpeed, maxWalkSpeed = 16, 8, 100
local jumpPower, minJumpPower, maxJumpPower = 50, 20, 200

local character, humanoid, root
local bodyVelocity, bodyGyro
local flyConnection, noclipConnection

-- ================= GUI PRINCIPAL =================
local gui = Instance.new("ScreenGui")
gui.Name = "CATHUD_MOBILE"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- √çCONE FLUTUANTE (ABRIR/FECHAR)
local hudIcon = Instance.new("TextButton")
hudIcon.Size = UDim2.new(0,55,0,55)
hudIcon.Position = UDim2.new(0.05,0,0.15,0)
hudIcon.BackgroundColor3 = Color3.fromRGB(150,0,0)
hudIcon.Text = "ü©∏"
hudIcon.TextScaled = true
hudIcon.Parent = gui
Instance.new("UICorner", hudIcon).CornerRadius = UDim.new(1,0)

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0,320,0,450) -- Tamanho otimizado para celular
mainFrame.Position = UDim2.new(0.5,0,0.5,0)
mainFrame.AnchorPoint = Vector2.new(0.5,0.5)
mainFrame.BackgroundColor3 = Color3.fromRGB(20,0,0)
mainFrame.BorderSizePixel = 2
mainFrame.Visible = false
mainFrame.Parent = gui

Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0,15)

-- BOT√ïES DE VOO (S√ì APARECEM NO FLY)
local flyControls = Instance.new("Frame")
flyControls.Size = UDim2.new(0,60,0,130)
flyControls.Position = UDim2.new(0.85,0,0.5,0)
flyControls.BackgroundTransparency = 1
flyControls.Visible = false
flyControls.Parent = gui

local function createFlyBtn(text, pos, val)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1,0,0.45,0)
    btn.Position = pos
    btn.BackgroundColor3 = Color3.fromRGB(150,0,0)
    btn.Text = text
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Parent = flyControls
    Instance.new("UICorner", btn)
    return btn
end

local btnUp = createFlyBtn("UP", UDim2.new(0,0,0,0))
local btnDown = createFlyBtn("DN", UDim2.new(0,0,0.55,0))

local moveUp, moveDown = 0, 0
btnUp.MouseButton1Down:Connect(function() moveUp = 1 end)
btnUp.MouseButton1Up:Connect(function() moveUp = 0 end)
btnDown.MouseButton1Down:Connect(function() moveDown = 1 end)
btnDown.MouseButton1Up:Connect(function() moveDown = 0 end)

-- ================= SLIDER MOBILE =================
local function createSlider(yPos, minValue, maxValue, value, text, callback)
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.9,0,0,25)
    label.Position = UDim2.new(0.05,0,0,yPos)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255,0,0)
    label.Text = text.." "..value
    label.Parent = mainFrame

    local bar = Instance.new("Frame")
    bar.Size = UDim2.new(0.8,0,0,10)
    bar.Position = UDim2.new(0.1,0,0,yPos+30)
    bar.BackgroundColor3 = Color3.fromRGB(60,0,0)
    bar.Parent = mainFrame

    local handle = Instance.new("Frame")
    handle.Size = UDim2.new(0,25,0,25)
    handle.AnchorPoint = Vector2.new(0.5,0.5)
    handle.Position = UDim2.new((value-minValue)/(maxValue-minValue),0,0.5,0)
    handle.BackgroundColor3 = Color3.fromRGB(255,0,0)
    handle.Parent = bar
    Instance.new("UICorner", handle).CornerRadius = UDim.new(1,0)

    local function update(input)
        local pos = math.clamp((input.Position.X - bar.AbsolutePosition.X) / bar.AbsoluteSize.X, 0, 1)
        handle.Position = UDim2.new(pos, 0, 0.5, 0)
        local nVal = math.floor(minValue + (maxValue - minValue) * pos)
        label.Text = text.." "..nVal
        callback(nVal)
    end

    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
            local moveCon
            moveCon = UserInputService.InputChanged:Connect(function(move)
                if move.UserInputType == Enum.UserInputType.Touch or move.UserInputType == Enum.UserInputType.MouseMovement then
                    update(move)
                end
            end)
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then moveCon:Disconnect() end
            end)
        end
    end)
end

-- CONFIGURA√á√ÉO DOS SLIDERS
createSlider(80, minSpeed, maxSpeed, speed, "Voo:", function(v) speed = v end)
createSlider(160, minWalkSpeed, maxWalkSpeed, walkSpeed, function(v) 
    if player.Character and player.Character:FindFirstChild("Humanoid") then
        player.Character.Humanoid.WalkSpeed = v
    end
end)
createSlider(240, minJumpPower, maxJumpPower, jumpPower, "Pulo:", function(v)
    if player.Character and player.Character:FindFirstChild("Humanoid") then
        player.Character.Humanoid.JumpPower = v
    end
end)

-- ================= FUN√á√ïES FLY / NOCLIP =================
local function toggleFly()
    flying = not flying
    flyControls.Visible = flying
    if flying then
        character = player.Character
        root = character:WaitForChild("HumanoidRootPart")
        humanoid = character:WaitForChild("Humanoid")
        humanoid.PlatformStand = true
        
        bodyVelocity = Instance.new("BodyVelocity", root)
        bodyVelocity.MaxForce = Vector3.new(9e9,9e9,9e9)
        bodyGyro = Instance.new("BodyGyro", root)
        bodyGyro.MaxTorque = Vector3.new(9e9,9e9,9e9)
        bodyGyro.P = 10000

        flyConnection = RunService.RenderStepped:Connect(function()
            local cam = workspace.CurrentCamera
            -- No Mobile, o voo vai pra onde a c√¢mera aponta + bot√µes UP/DN
            local dir = (cam.CFrame.LookVector * 1) + (Vector3.new(0,1,0) * (moveUp - moveDown))
            bodyVelocity.Velocity = dir * speed
            bodyGyro.CFrame = cam.CFrame
        end)
    else
        if flyConnection then flyConnection:Disconnect() end
        if bodyVelocity then bodyVelocity:Destroy() end
        if bodyGyro then bodyGyro:Destroy() end
        if player.Character:FindFirstChild("Humanoid") then
            player.Character.Humanoid.PlatformStand = false
        end
    end
end

local function toggleNoclip()
    noclip = not noclip
    if noclip then
        noclipConnection = RunService.Stepped:Connect(function()
            if player.Character then
                for _, v in pairs(player.Character:GetDescendants()) do
                    if v:IsA("BasePart") then v.CanCollide = false end
                end
            end
        end)
    else
        if noclipConnection then noclipConnection:Disconnect() end
    end
end

-- BOT√ïES FINAIS
local btnFly = Instance.new("TextButton")
btnFly.Size = UDim2.new(0.4,0,0,50)
btnFly.Position = UDim2.new(0.05,0,0.85,0)
btnFly.Text = "Fly"
btnFly.Parent = mainFrame
btnFly.MouseButton1Click:Connect(toggleFly)

local btnClip = Instance.new("TextButton")
btnClip.Size = UDim2.new(0.4,0,0,50)
btnClip.Position = UDim2.new(0.55,0,0.85,0)
btnClip.Text = "Noclip"
btnClip.Parent = mainFrame
btnClip.MouseButton1Click:Connect(toggleNoclip)

hudIcon.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
end)
